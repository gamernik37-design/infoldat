<!DOCTYPE html>
<html lang="de">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Tests | Infoldat</title>
  <link rel="stylesheet" href="assets/css/style.css" />

  <style>
    /* Tests-spezifisch (klein + clean) */
    .toolbar { display:flex; gap:10px; flex-wrap:wrap; align-items:center; }
    .toolbar button, .toolbar a.btn {
      display:inline-block;
      padding:10px 14px; border-radius:12px;
      border:1px solid rgba(255,255,255,.16);
      background: rgba(255,255,255,.06);
      color: inherit; text-decoration:none;
      cursor:pointer;
    }
    .toolbar button:hover, .toolbar a.btn:hover { background: rgba(255,255,255,.10); }
    .muted { opacity:.85; }

    .test-wrap { margin-top: 16px; }
    .q-card { padding:16px; border-radius:14px; border:1px solid rgba(255,255,255,.12); background: rgba(255,255,255,.04); }
    .q-head { display:flex; justify-content:space-between; gap:10px; flex-wrap:wrap; align-items:flex-start; }
    .q-title { margin:0; font-size: 1.05rem; }
    .pill { font-size:.85rem; padding:4px 10px; border-radius:999px; border:1px solid rgba(255,255,255,.18); opacity:.9; }

    .scale { display:flex; gap:10px; flex-wrap:wrap; margin-top: 10px; }
    .scale label {
      display:inline-flex; gap:8px; align-items:center;
      padding:8px 10px; border-radius:12px;
      border:1px solid rgba(255,255,255,.14);
      background: rgba(0,0,0,.12);
      cursor:pointer;
    }
    .scale input { accent-color: currentColor; }

    .progress {
      margin-top: 12px;
      height: 10px;
      border-radius: 999px;
      background: rgba(255,255,255,.10);
      overflow:hidden;
      border:1px solid rgba(255,255,255,.12);
    }
    .progress > div { height: 100%; width: 0%; background: rgba(255,255,255,.50); }

    .result {
      margin-top: 18px;
      padding: 16px;
      border-radius: 14px;
      border:1px solid rgba(255,255,255,.16);
      background: rgba(255,255,255,.05);
      display:none;
    }
    .bars { display:grid; gap:10px; margin-top: 12px; }
    .bar-row { display:grid; grid-template-columns: 120px 1fr 70px; gap:10px; align-items:center; }
    .bar { height:10px; border-radius:999px; background: rgba(255,255,255,.10); overflow:hidden; border:1px solid rgba(255,255,255,.12); }
    .bar > div { height:100%; width:0%; background: rgba(255,255,255,.50); }
    .rec li { margin: 8px 0; }
    .danger { opacity:.95; }
  </style>
</head>

<body>

<nav>
  <a href="index.html">Start</a>
  <a href="Mission.html">Mission</a>
  <a href="vorbereitung/index.html">Vorbereitung</a>
  <a href="tests.html">Tests</a>
  <a href="kontakt.html">Kontakt</a>
</nav>

<section class="hero hero-image">
  <div class="hero-content">
    <h1>Tests</h1>
    <p>Check deinen Stand – und geh danach direkt zu den Seiten, die dir wirklich helfen.</p>
  </div>
</section>

<section class="section">
  <h2>So funktioniert’s</h2>
  <p class="muted">
    Skala: <strong>0</strong> = trifft nicht zu · <strong>1</strong> = teils · <strong>2</strong> = trifft zu.
    Danach bekommst du eine Auswertung + klare Empfehlungen.
  </p>

  <div class="toolbar">
    <button type="button" id="btnQuick">Schnelltest (10)</button>
    <button type="button" id="btnFull">Volltest (30)</button>
    <button type="button" id="btnEval">Auswerten</button>
    <button type="button" id="btnReset">Reset</button>
    <a class="btn" href="vorbereitung/index.html">Zur Vorbereitung →</a>
  </div>

  <div class="progress" aria-label="Fortschritt">
    <div id="progressBar"></div>
  </div>

  <div id="testContainer" class="test-wrap grid"></div>

  <div id="result" class="result">
    <h3>Ergebnis</h3>
    <p id="scoreLine"></p>
    <p id="levelLine" class="muted"></p>

    <h3 style="margin-top:14px;">Bereiche</h3>
    <div class="bars" id="bars"></div>

    <h3 style="margin-top:14px;">Empfehlungen</h3>
    <ul class="rec" id="recs"></ul>

    <p class="muted" id="nextHint" style="margin-top:10px;"></p>
  </div>
</section>

<footer>
  © 2026 Infoldat
  <div class="disclaimer">
    Keine offizielle staatliche oder militärische Website.
    Reine Informations- und Vorbereitungsplattform.
  </div>
</footer>

<script>
(() => {
  // Links zu euren Vorbereitung-Seiten (passt zu eurer Struktur)
  const areaConfig = {
    ablauf:     { title: "Ablauf",     link: "vorbereitung/ablauf.html" },
    phasen:     { title: "Phasen",     link: "vorbereitung/phasen.html" },
    ausruestung:{ title: "Ausrüstung", link: "vorbereitung/ausruestung.html" },
    packliste:  { title: "Packliste",  link: "vorbereitung/packliste.html" },
    mental:     { title: "Mental",     link: "vorbereitung/mental.html" },
  };

  // 0–2 Skala je Frage
  const QUESTIONS = [
    // Ablauf (6)
    { area:"ablauf", text:"Ich kann den groben Tagesablauf (Wecken bis Nachtruhe) erklären." },
    { area:"ablauf", text:"Ich komme mit klaren Regeln/Ansagen klar, ohne zu diskutieren." },
    { area:"ablauf", text:"Zeitdruck macht mich nicht handlungsunfähig." },
    { area:"ablauf", text:"Ich halte Routine durch (auch wenn’s langweilig wird)." },
    { area:"ablauf", text:"Ich kann Aufgaben priorisieren statt alles gleichzeitig zu wollen." },
    { area:"ablauf", text:"Ich bin pünktlich und bereite Dinge vorher vor." },

    // Phasen (6)
    { area:"phasen", text:"Ich verstehe: Anfang ist oft Chaos/Stress, später wird es strukturierter." },
    { area:"phasen", text:"Ich kann mich auf wechselnde Anforderungen je Phase einstellen." },
    { area:"phasen", text:"Ich weiß, warum die ersten Wochen mental hart sind (neue Regeln + Druck)." },
    { area:"phasen", text:"Ich halte durch, auch wenn ich mich noch nicht „zugehörig“ fühle." },
    { area:"phasen", text:"Ich kann Fortschritt realistisch sehen (nicht jeden Tag 100%)." },
    { area:"phasen", text:"Ich akzeptiere, dass manche Dinge „so sind“, ohne mich aufzureiben." },

    // Ausrüstung (6)
    { area:"ausruestung", text:"Ich halte Ordnung auch ohne Kontrolle." },
    { area:"ausruestung", text:"Ich mache Pflege/Checks regelmäßig – nicht erst kurz vor knapp." },
    { area:"ausruestung", text:"Ich verliere selten Dinge (oder habe System dagegen)." },
    { area:"ausruestung", text:"Ich kann sauber/gründlich arbeiten, auch wenn es nervt." },
    { area:"ausruestung", text:"Ich verstehe: Ausrüstung = Verantwortung + Disziplin-Test." },
    { area:"ausruestung", text:"Ich kann Sachen standardisiert packen/ablegen (immer gleich)." },

    // Packliste (6)
    { area:"packliste", text:"Ich packe funktional (nicht nach Komfort-Impuls)." },
    { area:"packliste", text:"Ich verstehe, warum zu viel Gepäck Stress verursacht." },
    { area:"packliste", text:"Ich kann priorisieren: Dokumente/Essentials zuerst." },
    { area:"packliste", text:"Ich kann auf unnötigen Kram verzichten (auch wenn’s schwer fällt)." },
    { area:"packliste", text:"Ich habe meine Basics (Hygiene, Wechsel, Kleinkram) im Griff." },
    { area:"packliste", text:"Ich kann Checklisten nutzen, ohne genervt zu sein." },

    // Mental (6)
    { area:"mental", text:"Ich nehme Kritik an, ohne sofort dicht zu machen." },
    { area:"mental", text:"Ich arbeite auch ohne Motivation zuverlässig weiter." },
    { area:"mental", text:"Unter Druck bleibe ich ruhig und arbeite Schritt für Schritt." },
    { area:"mental", text:"Ich kann mit wenig Schlaf/Stress umgehen, ohne komplett abzubauen." },
    { area:"mental", text:"Ich kann „Ego“ zurückstellen und einfach machen." },
    { area:"mental", text:"Ich finde nach Fehlern schnell wieder in den Fokus." }
  ];

  const QUICK_COUNT = 10; // Schnelltest
  const FULL_COUNT  = 30; // Volltest (alle)

  const container = document.getElementById("testContainer");
  const resultBox = document.getElementById("result");
  const scoreLine = document.getElementById("scoreLine");
  const levelLine = document.getElementById("levelLine");
  const barsEl = document.getElementById("bars");
  const recsEl = document.getElementById("recs");
  const nextHint = document.getElementById("nextHint");
  const progressBar = document.getElementById("progressBar");

  const LS_KEY = "infoldat_tests_v1";

  let currentQuestions = [];
  let mode = "full";

  function shuffle(arr) {
    const a = [...arr];
    for (let i = a.length - 1; i > 0; i--) {
      const j = Math.floor(Math.random() * (i + 1));
      [a[i], a[j]] = [a[j], a[i]];
    }
    return a;
  }

  function pickQuestions(which) {
    mode = which;
    if (which === "quick") {
      // ausgewogen: 2 pro Bereich (5 Bereiche => 10)
      const perArea = {};
      Object.keys(areaConfig).forEach(k => perArea[k] = []);
      QUESTIONS.forEach(q => perArea[q.area].push(q));

      const picked = [];
      Object.keys(perArea).forEach(area => {
        const arr = shuffle(perArea[area]).slice(0, 2);
        picked.push(...arr);
      });
      return picked;
    }
    return [...QUESTIONS]; // full
  }

  function render() {
    container.innerHTML = "";
    resultBox.style.display = "none";
    updateProgress();

    currentQuestions.forEach((q, idx) => {
      const card = document.createElement("div");
      card.className = "box q-card";

      const areaTitle = areaConfig[q.area]?.title || q.area;

      card.innerHTML = `
        <div class="q-head">
          <h4 class="q-title">${idx + 1}) ${q.text}</h4>
          <span class="pill">${areaTitle}</span>
        </div>

        <div class="scale" role="group" aria-label="Antwort auswählen">
          <label><input type="radio" name="q_${idx}" value="0"> 0 (nein)</label>
          <label><input type="radio" name="q_${idx}" value="1"> 1 (teils)</label>
          <label><input type="radio" name="q_${idx}" value="2"> 2 (ja)</label>
        </div>
      `;

      // on change -> progress + autosave
      card.addEventListener("change", () => {
        updateProgress();
        saveState();
      });

      container.appendChild(card);
    });

    loadStateIntoUI(); // wenn vorhanden
  }

  function getAnswers() {
    const answers = [];
    currentQuestions.forEach((_, idx) => {
      const checked = document.querySelector(`input[name="q_${idx}"]:checked`);
      answers.push(checked ? Number(checked.value) : null);
    });
    return answers;
  }

  function updateProgress() {
    const ans = getAnswers();
    const answered = ans.filter(v => v !== null).length;
    const total = currentQuestions.length;
    const pct = total === 0 ? 0 : Math.round((answered / total) * 100);
    progressBar.style.width = pct + "%";
  }

  function allAnswered() {
    return getAnswers().every(v => v !== null);
  }

  function computeScores() {
    const answers = getAnswers();

    const scores = { ablauf:0, phasen:0, ausruestung:0, packliste:0, mental:0 };
    const max = { ablauf:0, phasen:0, ausruestung:0, packliste:0, mental:0 };

    currentQuestions.forEach((q, idx) => {
      const v = answers[idx] ?? 0;
      scores[q.area] += v;
      max[q.area] += 2;
    });

    const total = Object.values(scores).reduce((a,b) => a + b, 0);
    const totalMax = Object.values(max).reduce((a,b) => a + b, 0);

    return { scores, max, total, totalMax };
  }

  function level(total, totalMax) {
    const pct = totalMax ? (total / totalMax) : 0;
    if (pct >= 0.80) return { label: "stabil", text: "Gute Basis. Jetzt Feinschliff und Routine." };
    if (pct >= 0.55) return { label: "mittel", text: "Solide Ansätze, aber klare Lücken – geh die schwächsten Bereiche zuerst an." };
    return { label: "kritisch", text: "Erst Grundlagen aufbauen. Starte mit den schwächsten Bereichen und arbeite systematisch." };
  }

  function renderBars(scores, max) {
    barsEl.innerHTML = "";
    Object.keys(areaConfig).forEach(areaKey => {
      const s = scores[areaKey] ?? 0;
      const m = max[areaKey] ?? 0;
      const pct = m ? Math.round((s / m) * 100) : 0;

      const row = document.createElement("div");
      row.className = "bar-row";
      row.innerHTML = `
        <div class="muted">${areaConfig[areaKey].title}</div>
        <div class="bar"><div style="width:${pct}%"></div></div>
        <div class="muted" style="text-align:right;">${s}/${m}</div>
      `;
      barsEl.appendChild(row);
    });
  }

  function renderRecs(scores, max) {
    recsEl.innerHTML = "";

    const entries = Object.keys(areaConfig).map(k => {
      const s = scores[k] ?? 0;
      const m = max[k] ?? 0;
      const pct = m ? (s / m) : 0;
      return { key:k, s, m, pct };
    }).sort((a,b) => a.pct - b.pct);

    entries.forEach((e, i) => {
      const cfg = areaConfig[e.key];
      let tag = "ok";
      if (e.pct < 0.35) tag = "Lücke";
      else if (e.pct < 0.65) tag = "unsicher";

      const li = document.createElement("li");
      li.innerHTML = `<strong>${i+1}.</strong> ${cfg.title}: <span class="pill">${tag}</span>
        – <a href="${cfg.link}">öffnen</a>`;
      recsEl.appendChild(li);
    });

    const top = entries[0];
    nextHint.innerHTML = `Start-Tipp: Geh zuerst auf <strong>${areaConfig[top.key].title}</strong> und arbeite dich dann nach oben.`;
  }

  function evalNow() {
    if (!allAnswered()) {
      alert("Bitte beantworte alle Fragen, dann kann ich auswerten.");
      return;
    }

    const { scores, max, total, totalMax } = computeScores();
    const lv = level(total, totalMax);

    scoreLine.innerHTML = `Gesamt: <strong>${total}/${totalMax}</strong> · Modus: <strong>${mode === "quick" ? "Schnelltest" : "Volltest"}</strong>`;
    levelLine.innerHTML = `Einschätzung: <strong>${lv.label}</strong> – ${lv.text}`;

    renderBars(scores, max);
    renderRecs(scores, max);

    resultBox.style.display = "block";
    resultBox.scrollIntoView({ behavior: "smooth", block: "start" });

    saveState(true); // save + mark evaluated
  }

  function saveState(evaluated = false) {
    const answers = getAnswers();
    const payload = {
      mode,
      questions: currentQuestions,
      answers,
      evaluated,
      ts: Date.now()
    };
    try { localStorage.setItem(LS_KEY, JSON.stringify(payload)); } catch {}
  }

  function loadStateIntoUI() {
    let raw = null;
    try { raw = localStorage.getItem(LS_KEY); } catch {}
    if (!raw) return;

    try {
      const data = JSON.parse(raw);
      if (!data || !Array.isArray(data.questions) || !Array.isArray(data.answers)) return;

      // nur laden wenn gleiche Anzahl Fragen
      if (data.questions.length !== currentQuestions.length) return;

      // answers setzen
      data.answers.forEach((v, idx) => {
        if (v === null || v === undefined) return;
        const el = document.querySelector(`input[name="q_${idx}"][value="${v}"]`);
        if (el) el.checked = true;
      });

      updateProgress();

      if (data.evaluated) {
        // optional: direkt wieder Ergebnis zeigen
        evalNow();
      }
    } catch {}
  }

  function resetAll() {
    try { localStorage.removeItem(LS_KEY); } catch {}
    render();
  }

  // Buttons
  document.getElementById("btnQuick").addEventListener("click", () => {
    currentQuestions = pickQuestions("quick");
    render();
  });

  document.getElementById("btnFull").addEventListener("click", () => {
    currentQuestions = pickQuestions("full");
    render();
  });

  document.getElementById("btnEval").addEventListener("click", evalNow);
  document.getElementById("btnReset").addEventListener("click", resetAll);

  // Start: Volltest
  currentQuestions = pickQuestions("full");
  render();
})();
</script>

</body>
</html>